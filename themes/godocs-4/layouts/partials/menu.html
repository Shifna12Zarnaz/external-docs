{{- $currentNode := . }}

{{ $version:= where site.Pages "Params.version" "!=" nil}}

{{ range $version}}
<ul id="{{.Params.version}}" class="version-tree menu  d-none py-4 pr-4 pl-0 pl-xl-4 border-right border-default mb-0">
{{- range (where (where site.Pages "Section" .Params.version) "Type" "docs" )}}
{{- template "section-tree-nav" dict "sect" . "currentnode" $currentNode }}
{{- end}}
</ul>
{{ end }}

<script>
  let versionTree = document.querySelectorAll(".version-tree");
  versionTree.forEach((el, i) => {
    let id = el.getAttribute("id");
    if ((id == urlVersion) || (id == urlVersionMultilingual)) {
      el.classList.remove("d-none");
    }
  });
</script>

<!-- templates -->
{{- define "section-tree-nav" }}
 {{- with .sect}}
  {{- if .IsSection }}
    {{- $numberOfPages := (add (len .Pages) (len .Sections)) }}
    {{- safeHTML .Params.head}}
    <li data-nav-id="{{.Permalink}}" class="sidenav-item {{- if ne $numberOfPages 0 }} haschildren{{end}}">

      <div>
        <a href="{{ .RelPermalink}}">{{safeHTML .Params.Pre}}{{.Title}}{{safeHTML .Params.Post}}</a>
        {{- if ne $numberOfPages 0 }}
        <div class="category-icon"><i class="fa fa-angle-right fa-lg"></i></div>
        {{- end}}
      </div>

      {{- if ne $numberOfPages 0 }}
      <ul>
        {{- $pages := .Pages }}
        {{- if .Sections}}
        {{- $pages = (.Pages | union .Sections) }}
        {{- end}}

        {{- range $pages.ByWeight }}
        {{- template "section-tree-nav" dict "sect" . }}
        {{- end}}
      </ul>
      {{- end}}

    </li>
  {{- end}}
 {{- end}}
{{- end}}